<?xml version="1.0" encoding="utf-8"?>
<configuration>
  <!--
    IIS Security Configuration
    This file configures security settings when the application is hosted on IIS.
    
    Security Features:
    - Custom HTTP headers for XSS/Clickjacking protection
    - URL filtering to block dangerous requests
    - Request limits to prevent DoS attacks
    - Hidden server version information
    - Blocked access to sensitive directories
  -->
  
  <location path="." inheritInChildApplications="false">
    <system.webServer>
      <!-- ASP.NET Core Module Configuration -->
      <handlers>
        <add name="aspNetCore" path="*" verb="*" modules="AspNetCoreModuleV2" resourceType="Unspecified" />
      </handlers>
      <aspNetCore processPath="dotnet" 
                  arguments=".\Application_Security_ASSGN2.dll" 
                  stdoutLogEnabled="false" 
                  stdoutLogFile=".\logs\stdout" 
                  hostingModel="inprocess">
        <environmentVariables>
          <environmentVariable name="ASPNETCORE_ENVIRONMENT" value="Production" />
        </environmentVariables>
      </aspNetCore>
      
      <!-- Security Headers -->
      <httpProtocol>
        <customHeaders>
          <!-- Remove server version headers to hide technology stack -->
          <remove name="X-Powered-By" />
          <remove name="Server" />
          
          <!-- XSS Protection -->
          <add name="X-XSS-Protection" value="1; mode=block" />
          
          <!-- Prevent MIME type sniffing -->
          <add name="X-Content-Type-Options" value="nosniff" />
          
          <!-- Prevent clickjacking -->
          <add name="X-Frame-Options" value="DENY" />
          
          <!-- Referrer policy -->
          <add name="Referrer-Policy" value="strict-origin-when-cross-origin" />
          
          <!-- Permissions policy (restrict browser features) -->
          <add name="Permissions-Policy" value="accelerometer=(), camera=(), geolocation=(), gyroscope=(), magnetometer=(), microphone=(), payment=(), usb=()" />
        </customHeaders>
      </httpProtocol>
      
      <!-- URL Filtering - Block dangerous requests -->
      <security>
        <requestFiltering removeServerHeader="true">
          <!-- Block requests with double-encoded URLs (security bypass attempts) -->
          <requestLimits maxAllowedContentLength="10485760" maxUrl="4096" maxQueryString="2048" />
          
          <!-- Block specific URL sequences that could be exploits -->
          <denyUrlSequences>
            <!-- Path traversal attempts -->
            <add sequence=".." />
            <add sequence="//" />
            
            <!-- Common exploit patterns -->
            <add sequence=":" />
            <add sequence="\" />
            
            <!-- Block access to hidden/sensitive files -->
            <add sequence=".git" />
            <add sequence=".svn" />
            <add sequence=".env" />
            <add sequence=".config" />
            <add sequence="web.config" />
          </denyUrlSequences>
          
          <!-- Block specific file extensions -->
          <fileExtensions allowUnlisted="true">
            <add fileExtension=".cs" allowed="false" />
            <add fileExtension=".config" allowed="false" />
            <add fileExtension=".asax" allowed="false" />
            <add fileExtension=".ascx" allowed="false" />
            <add fileExtension=".master" allowed="false" />
            <add fileExtension=".skin" allowed="false" />
            <add fileExtension=".browser" allowed="false" />
            <add fileExtension=".sitemap" allowed="false" />
            <add fileExtension=".dll" allowed="false" />
            <add fileExtension=".mdf" allowed="false" />
            <add fileExtension=".ldf" allowed="false" />
            <add fileExtension=".log" allowed="false" />
            <add fileExtension=".sql" allowed="false" />
            <add fileExtension=".bak" allowed="false" />
          </fileExtensions>
          
          <!-- Block dangerous HTTP verbs -->
          <verbs allowUnlisted="true">
            <add verb="TRACE" allowed="false" />
            <add verb="TRACK" allowed="false" />
            <add verb="DEBUG" allowed="false" />
            <add verb="OPTIONS" allowed="false" />
          </verbs>
          
          <!-- Block requests with certain headers (potential attacks) -->
          <hiddenSegments>
            <add segment="bin" />
            <add segment="App_Data" />
            <add segment="App_Code" />
            <add segment="App_GlobalResources" />
            <add segment="App_LocalResources" />
            <add segment="App_WebReferences" />
            <add segment="App_Browsers" />
          </hiddenSegments>
        </requestFiltering>
      </security>
      
      <!-- Custom Error Pages - Hide server details -->
      <httpErrors errorMode="Custom" existingResponse="Replace">
        <remove statusCode="400" />
        <remove statusCode="401" />
        <remove statusCode="403" />
        <remove statusCode="404" />
        <remove statusCode="500" />
        <error statusCode="400" path="/Error/400" responseMode="ExecuteURL" />
        <error statusCode="401" path="/Error/401" responseMode="ExecuteURL" />
        <error statusCode="403" path="/Error/403" responseMode="ExecuteURL" />
        <error statusCode="404" path="/Error/404" responseMode="ExecuteURL" />
        <error statusCode="500" path="/Error/500" responseMode="ExecuteURL" />
      </httpErrors>
    </system.webServer>
  </location>
</configuration>
